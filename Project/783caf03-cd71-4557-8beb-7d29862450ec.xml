{"CLs":[{"__type":"IST","EID":"13d84da7-537f-47b2-9ef6-01c115927a8b","H":624,"TXT":"CASE StartState OF\u000d\u000a\u0009Init:\u000d\u000a\u0009\u0009\/\/ Clear flags\u000d\u000a\u0009\u0009StartFSMTimeout\u0009:=FALSE;\u000d\u000a\u0009\u0009IF DoStartSequence THEN\u000d\u000a\u0009\u0009\u0009Drive1ResetAttempted\u0009:=FALSE;\u000d\u000a\u0009\u0009\u0009Drive2ResetAttempted\u0009:=FALSE;\u000d\u000a\u0009\u0009\u0009Drive1Data.Reset.Request := FALSE;\u000d\u000a\u0009\u0009\u0009Drive2Data.Reset.Request := FALSE;\u000d\u000a\u0009\u0009\u0009StartState \u0009\u0009\u0009:= CloseSR;\u000d\u000a\u0009\u0009\u0009StartSequenceError\u0009\u0009:= FALSE;\u000d\u000a\u0009\u0009\u0009StartFSMTimeout \u0009\u0009:= TRUE;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009CloseSR:\u000d\u000a\u0009\u0009DrivePower := TRUE;\u000d\u000a\u0009\u0009StartState := CheckSR1Closed;\u000d\u000a\u0009\u0009\u000d\u000a\u0009CheckSR1Closed:\u000d\u000a\u0009\u0009IF SR1_On AND SR2_On THEN\u000d\u000a\u0009\u0009\u0009StartState := ConnectSupervisor;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009\u0009\u0009InitBLVL:\u000d\u000a\u0009\u0009Drive1.ReqInit := TRUE;\u000d\u000a\u0009\u0009StartState := WaitInitBLVL;\u000d\u000a\u0009\u0009\u000d\u000a\u0009WaitInitBLVL:\u000d\u000a\u0009\u0009IF Drive1.Ready THEN \u000d\u000a\u0009\u0009\u0009StartState := ResetBLVL;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009ResetBLVL:\u000d\u000a\u0009\u0009Drive1.ReqReset := TRUE;\u000d\u000a\u0009\u0009StartState := WaitResetBLVL;\u000d\u000a\u0009\u0009\u000d\u000a\u0009WaitResetBLVL:\u000d\u000a\u0009\u0009IF NOT (Drive1.ReqReset OR EC_BLVL_ALM1) THEN\u000d\u000a\u0009\u0009\u0009StartState := InitBLVR;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009\u0009InitBLVR:\u000d\u000a\u0009\u0009Drive2.ReqInit := TRUE;\u000d\u000a\u0009\u0009StartState := WaitInitBLVR;\u000d\u000a\u0009\u0009\u000d\u000a\u0009WaitInitBLVR:\u000d\u000a\u0009\u0009IF Drive2.Ready THEN \u000d\u000a\u0009\u0009\u0009StartState := ResetBLVR;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009ResetBLVR:\u000d\u000a\u0009\u0009Drive2.ReqReset := TRUE;\u000d\u000a\u0009\u0009StartState := WaitResetBLVR;\u000d\u000a\u0009\u0009\u000d\u000a\u0009WaitResetBLVR:\u000d\u000a\u0009\u0009IF NOT (Drive2.ReqReset OR EC_BLVR_ALM1) THEN\u000d\u000a\u0009\u0009\u0009StartState := ConnectSupervisor;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009\u0009\u000d\u000a\u0009ConnectSupervisor:\u000d\u000a\u0009\u0009StartState := CheckSupervisorOK;\u000d\u000a\u0009\u0009\u000d\u000a\u0009CheckSupervisorOK:\u000d\u000a\u0009\u0009StartState := CheckBatteryOK;\u000d\u000a\u0009\u0009\u000d\u000a\u0009CheckBatteryOK:\u000d\u000a\u0009\u0009IF BatteryVoltage > -10 THEN\u000d\u000a\u0009\u0009\u0009StartState := StartupOK;\u000d\u000a\u0009\u0009ELSE\u000d\u000a\u0009\u0009\u0009StartSequenceError := TRUE;\u000d\u000a\u0009\u0009END_IF;\u000d\u000a\u0009\u0009\u000d\u000a\u0009StartupFault:\u000d\u000a\u0009\u0009StartSequenceError := TRUE;\u000d\u000a\u0009\u0009StartState := Init;\u000d\u000a\u0009\u0009\u000d\u000a\u0009StartupOK:\u000d\u000a\u0009\u0009StartSequenceDone := TRUE;\u000d\u000a\u0009\u0009StartSequenceError := FALSE;\u000d\u000a\u0009\u0009StartFSMTimeout := FALSE;\u000d\u000a\u0009\u0009AllowUpdate := TRUE; \/\/ Allow periodic drive status updates\u000d\u000a\u0009\u0009AGVStarted := TRUE;\u000d\u000a\u0009\u0009Drive1Data.InCmd.AsWord:=WORD#16#01;\u000d\u000a\u0009\u0009Drive2Data.InCmd.AsWord:=WORD#16#01;\u000d\u000a\u0009\u0009StartState := Init;\u000d\u000aELSE\u000d\u000a\u0009StartState := Init;\u000d\u000aEND_CASE;","W":514}],"LRI":1,"RRI":2,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"StartFSMTimeout"},{"__type":"FB","In":[{"__type":"PF","Arg":"In"},{"__type":"PRM","Arg":"PT","Ix":2,"Type":"TIME","Var":"T#5s"}],"Ix":4,"Name":"TON","Out":[{"__type":"PF","Arg":"Q"},{"__type":"PRM","Arg":"ET","Ix":3,"Type":"TIME","Var":"FSMTimeout_ET"}],"X":1,"Var":"FSMTimeout_FB"},{"__type":"ST","Ix":1,"Var":"StartupTimeoutFault","X":2}],"LRI":5,"RRI":6,"VLs":[]}
{"CLs":[{"__type":"LD","Var":"StartupTimeoutFault"},{"__type":"ST","Ix":1,"S":true,"Var":"StartSequenceError","X":1}],"LRI":2,"RRI":3,"VLs":[]}
{"CLs":[{"__type":"LD","Id":"ac32e253-e6af-46f7-9760-f90b000000d7","Up":true,"Var":"StartSequenceError"},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":1,"Type":"ANY","Var":"StartState"}],"Ix":5,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":2,"Type":"ANY","Var":"StartupFaultState"}],"X":1},{"__type":"F","In":[{"__type":"PF","Arg":"EN"},{"__type":"PRM","Arg":"In","Ix":3,"Type":"ANY","Var":"StartupStates#Init"}],"Ix":6,"Name":"MOVE","Out":[{"__type":"PF","Arg":"ENO"},{"__type":"PRM","Arg":"Out","Ix":4,"Type":"ANY","Var":"StartState"}],"X":2}],"LRI":7,"RRI":8,"VLs":[]}
